<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Team Member</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            padding: 3rem;
        }
        .form-container {
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 500px;
        }
        .form-label {
            font-weight: 600;
            color: #495057;
        }
        .btn-success {
            background-color: #28a745;
            border-color: #28a745;
            padding: 0.5rem 1.5rem;
        }
        h3 {
            color: #343a40;
            margin-bottom: 1.5rem;
        }
    </style>
</head>
<body class="p-5">

<h3>Add Team Member to Case</h3>

<form id="teamForm">
    <div class="mb-3">
<!--        <label class="form-label">Case</label>-->
        <input type="hidden" id="caseTitle" name="caseTitle" class="form-control" readonly>
    </div>

    <div class="mb-3">
        <label class="form-label">Employee Email</label>
        <input type="email" id="email" name="email" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Role</label>
        <select id="role" name="role" class="form-select" required>
            <option value="">-- Select Role --</option>
            <option value="reporter">Reporter</option>
            <option value="editor">Editor</option>
            <option value="admin">Admin</option>
        </select>
    </div>

    <input type="hidden" id="caseId" name="caseId">
    <button type="submit" class="btn btn-success">Assign</button>
</form>

<script>
    // Prefill form fields from URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    document.getElementById('caseTitle').value = urlParams.get('caseTitle') || '';
    document.getElementById('caseId').value = urlParams.get('caseId') || '';


    //     fetch Case_id
    const pathSegments = window.location.pathname.split('/');
    const caseIdFromUrl = pathSegments[pathSegments.length - 1];
    document.getElementById('caseId').value = caseIdFromUrl;

    document.getElementById('teamForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const payload = {
            case_id: parseInt(document.getElementById('caseId').value),
            email: document.getElementById('email').value,
            role: document.getElementById('role').value
        };

        const token = localStorage.getItem('jwt_token'); // üîê Get JWT token
        try {
            const response = await fetch('/Admin/add_member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(payload)
            });

            console.table(response);
            if (response.ok) {
                alert('Member added successfully!');
                window.location.href = '/CaseLine/Admin_dashboard'; // or redirect as needed
            } else {
                const errorMessage = await response.text();
                alert('Error: ' + errorMessage);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred');
        }
    });
</script>

</body>
</html>
