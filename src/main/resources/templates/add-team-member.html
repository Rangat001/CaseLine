<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Add Team Member</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="p-5">

<h3>Add Team Member to Case</h3>

<form id="teamForm">
    <div class="mb-3">
<!--        <label class="form-label">Case</label>-->
        <input type="hidden" id="caseTitle" name="caseTitle" class="form-control" readonly>
    </div>

    <div class="mb-3">
        <label class="form-label">Employee Email</label>
        <input type="email" id="email" name="email" class="form-control" required>
    </div>

    <div class="mb-3">
        <label class="form-label">Role</label>
        <select id="role" name="role" class="form-select" required>
            <option value="">-- Select Role --</option>
            <option value="reporter">Reporter</option>
            <option value="editor">Editor</option>
            <option value="admin">Admin</option>
        </select>
    </div>

    <input type="hidden" id="caseId" name="caseId">
    <button type="submit" class="btn btn-success">Assign</button>
</form>

<script>
    // Prefill form fields from URL query parameters
    const urlParams = new URLSearchParams(window.location.search);
    document.getElementById('caseTitle').value = urlParams.get('caseTitle') || '';
    document.getElementById('caseId').value = urlParams.get('caseId') || '';


    //     fetch Case_id
    const pathSegments = window.location.pathname.split('/');
    const caseIdFromUrl = pathSegments[pathSegments.length - 1];
    document.getElementById('caseId').value = caseIdFromUrl;

    document.getElementById('teamForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        const payload = {
            case_id: parseInt(document.getElementById('caseId').value),
            email: document.getElementById('email').value,
            role: document.getElementById('role').value
        };

        const token = localStorage.getItem('jwt_token'); // üîê Get JWT token
        try {
            const response = await fetch('/Admin/add_member', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(payload)
            });

            if (response.ok) {
                alert('Member added successfully!');
                window.location.href = 'Admin_dashboard'; // or redirect as needed
            } else {
                alert('Failed to add member');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred');
        }
    });
</script>

</body>
</html>
